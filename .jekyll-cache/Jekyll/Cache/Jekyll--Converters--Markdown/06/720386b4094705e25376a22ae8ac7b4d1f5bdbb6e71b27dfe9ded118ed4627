I"Ëi<blockquote>
  <p>ê³ ê° ëª©ë¡ì— ê³ ê°ë³„ ìµœê·¼ ì£¼ë¬¸ 1ê±´ì— ëŒ€í•œ ìš”ì•½ ì •ë³´ë¥¼ ë³´ì—¬ì£¼ì„¸ìš”.</p>
</blockquote>

<p>ë¼ëŠ” ìš”êµ¬ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤.</p>

<p>â€œê³ ê°â€ ê°ì²´ì™€ â€œì£¼ë¬¸â€ ê°ì²´ê°„ì˜ ê´€ê³„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+------------+           0..* +------------+
|  Customer  | &lt;&gt;-----------&gt; |   Order    |
+------------+                +------------+
</code></pre></div></div>

<p>ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆì´ì–´ì—ì„œ êµ¬í˜„í•œë‹¤ë©´, ORMì„ í†µí•´ êµ¬í•œ <code class="highlighter-rouge">Collection&lt;Customer&gt;</code>ì„ ìˆœíšŒí•˜ë©´ì„œ, <code class="highlighter-rouge">Customer</code>ê°ì²´ì˜ ë©¤ë²„ í•„ë“œì¸ <code class="highlighter-rouge">Collection&lt;Order&gt;</code>ë¥¼ ëŒ€ìƒìœ¼ë¡œ ìµœê·¼ Order ê°ì²´ë§Œ í•„í„°ë§í–ˆê±°ë‚˜, ì ì ˆí•œ ìˆœì„œë¡œ ì •ë ¬í•˜ì—¬ ë½‘ì•„ ì“°ê¸° ì‰½ë„ë¡ í–ˆì„ê²ë‹ˆë‹¤. ìš”ëŸ° ëŠë‚Œìœ¼ë¡œìš”(ê²€ì¦ ì•ˆëœ Pseudo Code ì…ë‹ˆë‹¤).</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Service Layer</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">listCustomers</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nv">$customers</span><span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Customer</span> <span class="nv">$customer</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$sorted</span> <span class="o">=</span> <span class="nv">$customer</span><span class="o">-&gt;</span><span class="na">orders</span><span class="o">-&gt;</span><span class="na">sortByDesc</span><span class="p">(</span><span class="s1">'id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">values</span><span class="p">();</span>
        <span class="nv">$customer</span><span class="o">-&gt;</span><span class="na">setRelation</span><span class="p">(</span><span class="s1">'orders'</span><span class="p">,</span> <span class="nv">$sorted</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$customer</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Controller/View ë“±</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$customers</span> <span class="k">as</span> <span class="nv">$customer</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$lastOrder</span> <span class="o">=</span> <span class="nv">$customer</span><span class="o">-&gt;</span><span class="na">orders</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
    <span class="nv">$lastOrder</span><span class="o">-&gt;</span><span class="na">order_number</span><span class="p">;</span> <span class="c1">// ìµœê·¼ ì£¼ë¬¸ ë²ˆí˜¸   </span>
<span class="p">}</span>
</code></pre></div></div>

<p>ë¬¸ì œì ë“¤ì´ ëˆˆì— ë•ë‹ˆë‹¤.</p>

<ul>
  <li>ì‹œê°„ë³µì¡ë„ëŠ” O(m x n)ì…ë‹ˆë‹¤.</li>
  <li>CPUì™€ ë©”ëª¨ë¦¬ë¥¼ í˜¹ì‚¬ì‹œí‚µë‹ˆë‹¤.</li>
  <li><code class="highlighter-rouge">Customer.orders: Collection&lt;Order&gt;</code>ë¥¼ ë¯¸ë¦¬ ë¡œë“œí•˜ì§€ ì•Šì•˜ë‹¤ë©´, N + 1 ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.</li>
  <li>ì´ ì™¸ì—ë„ ì œê°€ ë³´ì§€ ëª»í•œ ë¬¸ì œì ë“¤ì´ ë” ìˆì„ ê²ë‹ˆë‹¤â€¦</li>
</ul>

<p>ì½ê¸° ì „ìš© ì¿¼ë¦¬ì´ë¯€ë¡œ ORMì„ ì“°ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤. ì‹¸ê³ , ë¹ ë¥´ê³ , ì•ˆì „í•˜ê²Œ SQLë§Œìœ¼ë¡œ ë½‘ì•„ë‚´ëŠ” ë°©ë²•ì„ ì°¾ì•„ë´¤ìŠµë‹ˆë‹¤.</p>

<!--more-->
<div class="spacer">â€¢ â€¢ â€¢</div>

<h2 id="1-í…Œì´ë¸”-ìŠ¤í‚¤ë§ˆ">1. í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ</h2>

<p>ê°„ê²°í•¨ì„ ìœ„í•´ ì£¼ë³€ í…Œì´ë¸”ê³¼ ì •ê·œí™”ë“±ì€ ëª¨ë“€ ìƒëµí•©ë‹ˆë‹¤(e.g. <code class="highlighter-rouge">order_lines</code>, <code class="highlighter-rouge">products</code>, â€¦).</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+------------+                +------------+
|  customers | -|----------o&lt; |   orders   |
+------------+                +------------+
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">customers</span> <span class="p">(</span>
  <span class="n">customer_id</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span>
  <span class="n">zipcode</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
  <span class="n">phonenumber</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">13</span><span class="p">),</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">customer_id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">customers</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">zipcode</span><span class="p">,</span> <span class="n">phonenumber</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'ì´ë•ìŠ¹'</span><span class="p">,</span> <span class="s1">'34603'</span><span class="p">,</span> <span class="s1">'01012345678'</span><span class="p">),</span>
       <span class="p">(</span><span class="s1">'ì„í¬ì¼'</span><span class="p">,</span> <span class="s1">'06035'</span><span class="p">,</span> <span class="s1">'01011112222'</span><span class="p">),</span>
       <span class="p">(</span><span class="s1">'ì‹ ì´ˆì•„'</span><span class="p">,</span> <span class="s1">'06611'</span><span class="p">,</span> <span class="s1">'01043218765'</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="p">(</span>
  <span class="n">order_number</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="n">customer_id</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="nb">unsigned</span><span class="p">,</span>
  <span class="n">order_total</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
  <span class="n">created_at</span> <span class="nb">datetime</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">order_number</span><span class="p">),</span>
  <span class="k">CONSTRAINT</span> <span class="n">orders_customer_id_foreign</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">customer_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">customers</span> <span class="p">(</span><span class="n">customer_id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">orders</span> <span class="p">(</span><span class="n">customer_id</span><span class="p">,</span> <span class="n">order_total</span><span class="p">,</span> <span class="n">created_at</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="nv">"2018-01-01 12:00:00"</span><span class="p">),</span>
       <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="nv">"2018-08-25 13:00:00"</span><span class="p">),</span>
       <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="nv">"2018-11-20 14:00:00"</span><span class="p">),</span>
       <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="nv">"2018-05-05 09:00:00"</span><span class="p">),</span>
       <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="nv">"2018-10-01 10:00:00"</span><span class="p">),</span>
<span class="p">;</span>
</code></pre></div></div>

<h2 id="2-ê³ ê°ê³¼-ì£¼ë¬¸-í…Œì´ë¸”-left-ì¡°ì¸">2. ê³ ê°ê³¼ ì£¼ë¬¸ í…Œì´ë¸” LEFT ì¡°ì¸</h2>

<p>ê³ ê°ë²ˆí˜¸ 1ë²ˆ â€œì´ë•ìŠ¹â€ ê³ ê°ì˜ ì£¼ë¬¸ 3ê±´ê³¼, ê³ ê°ë²ˆí˜¸ 3ë²ˆ â€œì‹ ì´ˆì•„â€ ê³ ê°ì˜ ì£¼ë¬¸ 2ê±´, í•œë²ˆë„ ì£¼ë¬¸í•œ ì ì´ ì—†ëŠ” ê³ ê°ë²ˆí˜¸ 2ë²ˆ â€œì„í¬ì¼â€ ê³ ê°ì˜ NULLì„ í¬í•¨í•´ ì´ 6ê±´ì˜ ê²°ê³¼ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> 
    <span class="k">c</span><span class="p">.</span><span class="n">customer_id</span> <span class="k">AS</span> <span class="n">cid</span><span class="p">,</span>
    <span class="n">o1</span><span class="p">.</span><span class="n">order_number</span> <span class="k">AS</span> <span class="n">o1n</span>
<span class="k">FROM</span> <span class="n">customers</span> <span class="k">AS</span> <span class="k">c</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">orders</span> <span class="k">AS</span> <span class="n">o1</span> <span class="k">ON</span> <span class="k">c</span><span class="p">.</span><span class="n">customer_id</span> <span class="o">=</span> <span class="n">o1</span><span class="p">.</span><span class="n">customer_id</span>
<span class="p">;</span> <span class="c1">-- No errors; 6 rows affected</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cid o1n
1   1
1   2
1   3
2   NULL
3   4
3   5
</code></pre></div></div>

<p>ì°¸ê³ ë¡œ, í•œë²ˆì´ë¼ë„ ì£¼ë¬¸í•œ ê³ ê°ì˜ ê³ ê°ë³„â€¦ê³¼ ê°™ì€ ìš”êµ¬ì‚¬í•­ì´ì—ˆë‹¤ë©´, LEFT JOIN ëŒ€ì‹  INNER JOINì„ ì´ìš©í–ˆì„í…Œê³ , 5ê±´ì˜ ê²°ê³¼ê°€ ì¶œë ¥ëì„ ê²ë‹ˆë‹¤.</p>

<h2 id="3-ê³ ê°ê³¼-ì£¼ë¬¸-í…Œì´ë¸”-left-ì¡°ì¸">3. ê³ ê°ê³¼ ì£¼ë¬¸ í…Œì´ë¸” LEFT ì¡°ì¸</h2>

<p>ì¡°ì¸ì€ ë‘ í…Œì´ë¸”ì„ ì¡°ì¸í•´ ì¤‘ê°„ ê²°ê³¼ ì§‘í•©ì„ ë§Œë“  í›„, ì´ ê²°ê³¼ ì§‘í•©ê³¼ ë‹¤ìŒ í…Œì´ë¸”ì„ ì¡°ì¸í•˜ëŠ” ì‹ìœ¼ë¡œ ë™ì‘í•œë‹¤ê³  ì•Œê³  ìˆìŠµë‹ˆë‹¤. 2ì ˆì˜ ì„ í–‰ ì¡°ì¸ì—ì„œ ë§Œë“¤ì–´ì§„ ê²°ê³¼ ì§‘í•©ì˜ ê° ë¡œìš°ì™€ ì£¼ë¬¸ í…Œì´ë¸” o2ë¥¼ í•œë²ˆ ë” LEFT ì¡°ì¸í•©ë‹ˆë‹¤.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> 
    <span class="k">c</span><span class="p">.</span><span class="n">customer_id</span> <span class="k">AS</span> <span class="n">cid</span><span class="p">,</span>
    <span class="n">o1</span><span class="p">.</span><span class="n">order_number</span> <span class="k">AS</span> <span class="n">o1n</span><span class="p">,</span>
    <span class="n">o2</span><span class="p">.</span><span class="n">order_number</span> <span class="k">AS</span> <span class="n">o2n</span>
<span class="k">FROM</span> <span class="n">customers</span> <span class="k">AS</span> <span class="k">c</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">orders</span> <span class="k">AS</span> <span class="n">o1</span> <span class="k">ON</span> <span class="k">c</span><span class="p">.</span><span class="n">customer_id</span> <span class="o">=</span> <span class="n">o1</span><span class="p">.</span><span class="n">customer_id</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">orders</span> <span class="k">AS</span> <span class="n">o2</span> <span class="k">ON</span> <span class="k">c</span><span class="p">.</span><span class="n">customer_id</span> <span class="o">=</span> <span class="n">o2</span><span class="p">.</span><span class="n">customer_id</span>
<span class="p">;</span> <span class="c1">-- No errors; 14 rows affected</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cid o1n o2n
1   1   1
1   1   2
1   1   3
1   2   1
1   2   2
1   2   3
1   3   1
1   3   2
1   3   3
2   NULLNULL
3   4   4
3   4   5
3   5   4
3   5   5
</code></pre></div></div>

<ul>
  <li>ì„ í–‰ ê²°ê³¼ ì§‘í•©ì˜ {cid:1, o1n:1} ë¡œìš°ì™€ ì¡°ì¸ë˜ëŠ” ì£¼ë¬¸ í…Œì´ë¸” o2ì˜ ë¡œìš°ëŠ” customer_idê°€ 1ì¸ ë¡œìš° 3ê°œì…ë‹ˆë‹¤.</li>
  <li>ì„ í–‰ ê²°ê³¼ ì§‘í•©ì˜ {cid:1, o1n:2} ë¡œìš°ì™€ ì¡°ì¸ë˜ëŠ” ì£¼ë¬¸ í…Œì´ë¸” o2ì˜ ë¡œìš°ëŠ” customer_idê°€ 1ì¸ ë¡œìš° 3ê°œì…ë‹ˆë‹¤.</li>
  <li>ì„ í–‰ ê²°ê³¼ ì§‘í•©ì˜ {cid:1, o1n:3} ë¡œìš°ì™€ ì¡°ì¸ë˜ëŠ” ì£¼ë¬¸ í…Œì´ë¸” o2ì˜ ë¡œìš°ëŠ” customer_idê°€ 1ì¸ ë¡œìš° 3ê°œì…ë‹ˆë‹¤.</li>
  <li>ì„ í–‰ ê²°ê³¼ ì§‘í•©ì˜ {cid:2, o1n:NULL} ë¡œìš°ì™€ ì¡°ì¸ë˜ëŠ” ì£¼ë¬¸ í…Œì´ë¸” o2ì˜ ë¡œìš°ëŠ” ì—†ìŠµë‹ˆë‹¤.</li>
  <li>ì„ í–‰ ê²°ê³¼ ì§‘í•©ì˜ {cid:3, o1n:4} ë¡œìš°ì™€ ì¡°ì¸ë˜ëŠ” ì£¼ë¬¸ í…Œì´ë¸” o2ì˜ ë¡œìš°ëŠ” customer_idê°€ 3ì¸ ë¡œìš° 2ê°œì…ë‹ˆë‹¤.</li>
  <li>ì„ í–‰ ê²°ê³¼ ì§‘í•©ì˜ {cid:3, o1n:5} ë¡œìš°ì™€ ì¡°ì¸ë˜ëŠ” ì£¼ë¬¸ í…Œì´ë¸” o2ì˜ ë¡œìš°ëŠ” customer_idê°€ 3ì¸ ë¡œìš° 2ê°œì…ë‹ˆë‹¤.</li>
</ul>

<p>ì™œ ê²°ê³¼ê°€ 14í–‰ì´ ë‚˜ì™”ëŠ”ì§€ ì´í•´ë˜ì…¨ì£ ?</p>

<h2 id="4-left-ì¡°ì¸-ì¡°ê±´-ì¶”ê°€">4. LEFT ì¡°ì¸ ì¡°ê±´ ì¶”ê°€</h2>

<p>ì™¼ìª½ ë˜ëŠ” ì˜¤ë¥¸ìª½ ì–´ëŠ ìª½ì´ë“  ë¬´ê´€í•˜ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ì™¼ìª½(ì„ í–‰ ê²°ê³¼ ì§‘í•©) í…Œì´ë¸”ì˜ ë ˆì½”ë“œë¥¼ ë²„ë¦¬ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ë²„ë¦¬ëŠ” ì¡°ê±´ì€ â€œë‚˜í•œí…Œ ê°€ìœ„ë°”ìœ„ë³´ ì§„ ì‚¬ëŒ ì „ë¶€ ì•‰ì•„!â€ì™€ ë¹„ìŠ·í•©ë‹ˆë‹¤. ì™¼ìª½ì´ ì˜¤ë¥¸ìª½ë³´ë‹¤ ì‘ì€ ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ê°€ì¡Œë‹¤ë©´ ë²„ë¦¬ëŠ” ê²ë‹ˆë‹¤.</p>

<p>ì£¼ë¬¸ë²ˆí˜¸ê°€ ë” í¬ë‹¤ë©´ ë” ìµœê·¼ì— ì£¼ë¬¸í•œ ê±´ì´ë©°, ê°™ì€ ê³ ê°ì„ ëŒ€ìƒìœ¼ë¡œ ì£¼ë¬¸ë²ˆí˜¸ê°€ ê°€ì¥ í° ë…€ì„ì„ ê³¨ë¼ë‚´ëŠ” ê³¼ì •ì´ë¼ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë²„ë¦°ë‹¤ê³  í‘œí˜„í–ˆì§€ë§Œ, ì—„ë°€íˆ ë§í•˜ë©´ LEFT JOINì˜ ì¡°ê±´ì‹ì„ ì¶©ì¡±í•˜ì§€ ëª»í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>

<p>ê·¸ëŸ°ë° LEFT JOINì´ë¯€ë¡œ 2ì ˆì—ì„œ ë„ì¶œí•œ ì„ í–‰ ê²°ê³¼ ì§‘í•©ì€ ê·¸ëŒ€ë¡œ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤. {cid:1, o1n:3} ë° {cid:3, o1n:5} ë¡œìš°ëŠ” ì¶©ì¡±í•˜ëŠ” ì˜¤ë¥¸ìª½ ê°’ì´ ì—†ë„¤ìš”. ê·¸ëŸ¼ì—ë„ ì„ í–‰ ê²°ê³¼ ì§‘í•© ìœ ì§€ë¥¼ ìœ„í•´ NULLì´ë¼ê³  í‘œí˜„í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cid o1n o2n
1   1   1   <span class="o">(</span>1 &lt; 1<span class="o">)</span> ë²„ë¦¼
1   1   2   <span class="o">(</span>1 &lt; 2<span class="o">)</span> ë‚¨ê¹€
1   1   3   <span class="o">(</span>1 &lt; 3<span class="o">)</span> ë‚¨ê¹€
1   2   1   <span class="o">(</span>2 &lt; 1<span class="o">)</span> ë²„ë¦¼
1   2   2   <span class="o">(</span>2 &lt; 2<span class="o">)</span> ë²„ë¦¼
1   2   3   <span class="o">(</span>2 &lt; 3<span class="o">)</span> ë‚¨ê¹€
1   3   1   <span class="o">(</span>3 &lt; 1<span class="o">)</span> ë²„ë¦¼
1   3   2   <span class="o">(</span>3 &lt; 2<span class="o">)</span> ë²„ë¦¼
1   3   3   <span class="o">(</span>3 &lt; 3<span class="o">)</span> ë²„ë¦¼
3   4   4   <span class="o">(</span>4 &lt; 4<span class="o">)</span> ë²„ë¦¼
3   4   5   <span class="o">(</span>4 &lt; 5<span class="o">)</span> ë‚¨ê¹€
3   5   4   <span class="o">(</span>5 &lt; 4<span class="o">)</span> ë²„ë¦¼
3   5   5   <span class="o">(</span>5 &lt; 5<span class="o">)</span> ë²„ë¦¼
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> 
    <span class="k">c</span><span class="p">.</span><span class="n">customer_id</span> <span class="k">AS</span> <span class="n">cid</span><span class="p">,</span>
    <span class="n">o1</span><span class="p">.</span><span class="n">order_number</span> <span class="k">AS</span> <span class="n">o1n</span><span class="p">,</span>
    <span class="n">o2</span><span class="p">.</span><span class="n">order_number</span> <span class="k">AS</span> <span class="n">o2n</span>
<span class="k">FROM</span> <span class="n">customers</span> <span class="k">AS</span> <span class="k">c</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">orders</span> <span class="k">AS</span> <span class="n">o1</span> <span class="k">ON</span> <span class="k">c</span><span class="p">.</span><span class="n">customer_id</span> <span class="o">=</span> <span class="n">o1</span><span class="p">.</span><span class="n">customer_id</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">orders</span> <span class="k">AS</span> <span class="n">o2</span> <span class="k">ON</span> <span class="k">c</span><span class="p">.</span><span class="n">customer_id</span> <span class="o">=</span> <span class="n">o2</span><span class="p">.</span><span class="n">customer_id</span>
    <span class="k">AND</span> <span class="n">o1</span><span class="p">.</span><span class="n">order_number</span> <span class="o">&lt;</span> <span class="n">o2</span><span class="p">.</span><span class="n">order_number</span>
<span class="p">;</span> <span class="c1">-- No errors; 7 rows affected</span>
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cid</span> <span class="n">o1n</span> <span class="n">o2n</span>
<span class="mi">1</span>   <span class="mi">1</span>   <span class="mi">2</span>
<span class="mi">1</span>   <span class="mi">1</span>   <span class="mi">3</span>
<span class="mi">1</span>   <span class="mi">2</span>   <span class="mi">3</span>
<span class="mi">1</span>   <span class="mi">3</span>   <span class="k">NULL</span>
<span class="mi">2</span>   <span class="n">NULLNULL</span>
<span class="mi">3</span>   <span class="mi">4</span>   <span class="mi">5</span>
<span class="mi">3</span>   <span class="mi">5</span>   <span class="k">NULL</span>
</code></pre></div></div>

<p>ì´í•´ë¥¼ ë•ê¸° ìœ„í•´ (ì‚¬ì‹¤ì€ ì œê°€ ì´í•´í•˜ê¸° ìœ„í•´) 3ì ˆê³¼ 4ì ˆì„ êµ¬ë¶„ ë™ì‘ìœ¼ë¡œ í‘œí˜„í–ˆì§€ë§Œ, ì‹¤ì œë¡œëŠ” ì—°ì† ë™ì‘ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.</p>

<h2 id="5-where-ì¡°ê±´ì ˆ-ì¶”ê°€">5. WHERE ì¡°ê±´ì ˆ ì¶”ê°€</h2>

<p>ë¶€ë“± ì¡°ì¸ ì¡°ê±´ì˜ ê²°ê³¼ê°€ ì—†ë‹¤ëŠ” ê²ƒì€ ê°€ì¥ í° ê°’ì´ë€ ì˜ë¯¸ì…ë‹ˆë‹¤. ë”°ë¼ì„œ o2 í…Œì´ë¸” ìª½ì— NULLì„ í’ˆê³  ìˆëŠ” ë¡œìš°ê°€ ê³ ê°ë³„ ìµœê·¼ ì£¼ë¬¸ì…ë‹ˆë‹¤.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> 
    <span class="k">c</span><span class="p">.</span><span class="n">customer_id</span> <span class="k">AS</span> <span class="n">cid</span><span class="p">,</span>
    <span class="n">o1</span><span class="p">.</span><span class="n">order_number</span> <span class="k">AS</span> <span class="n">o1n</span><span class="p">,</span>
    <span class="n">o2</span><span class="p">.</span><span class="n">order_number</span> <span class="k">AS</span> <span class="n">o2n</span>
<span class="k">FROM</span> <span class="n">customers</span> <span class="k">AS</span> <span class="k">c</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">orders</span> <span class="k">AS</span> <span class="n">o1</span> <span class="k">ON</span> <span class="k">c</span><span class="p">.</span><span class="n">customer_id</span> <span class="o">=</span> <span class="n">o1</span><span class="p">.</span><span class="n">customer_id</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">orders</span> <span class="k">AS</span> <span class="n">o2</span> <span class="k">ON</span> <span class="k">c</span><span class="p">.</span><span class="n">customer_id</span> <span class="o">=</span> <span class="n">o2</span><span class="p">.</span><span class="n">customer_id</span>
    <span class="k">AND</span> <span class="n">o1</span><span class="p">.</span><span class="n">order_number</span> <span class="o">&lt;</span> <span class="n">o2</span><span class="p">.</span><span class="n">order_number</span>
<span class="k">WHERE</span> <span class="n">o2</span><span class="p">.</span><span class="n">order_number</span> <span class="k">IS</span> <span class="k">NULL</span>   
<span class="p">;</span> <span class="c1">-- No errors; 2 rows affected</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cid o1n o2n
1   3   NULL
2   NULLNULL
3   5   NULL
</code></pre></div></div>

<h2 id="6-ìµœì¢…-ì¿¼ë¦¬">6. ìµœì¢… ì¿¼ë¦¬</h2>

<p>ê³ ê° ëª©ë¡ì— ìµœê·¼ ì£¼ë¬¸ ìš”ì•½ì„ í‘œí˜„í•˜ê¸° ìœ„í•œ ìµœì¢… ì¿¼ë¦¬ì…ë‹ˆë‹¤.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> 
    <span class="k">c</span><span class="p">.</span><span class="n">customer_id</span> <span class="k">AS</span> <span class="nv">"ê³ ê°ë²ˆí˜¸"</span><span class="p">,</span> 
    <span class="k">c</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="nv">"ê³ ê°ëª…"</span><span class="p">,</span>
    <span class="n">o1</span><span class="p">.</span><span class="n">order_number</span> <span class="k">AS</span> <span class="nv">"ì£¼ë¬¸ë²ˆí˜¸"</span><span class="p">,</span>
    <span class="n">o1</span><span class="p">.</span><span class="n">order_total</span> <span class="k">AS</span> <span class="nv">"ì£¼ë¬¸ê¸ˆì•¡"</span><span class="p">,</span>
    <span class="n">o1</span><span class="p">.</span><span class="n">created_at</span> <span class="k">AS</span> <span class="nv">"ì£¼ë¬¸ì¼ì‹œ"</span>
<span class="k">FROM</span> <span class="n">customers</span> <span class="k">AS</span> <span class="k">c</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">orders</span> <span class="k">AS</span> <span class="n">o1</span> <span class="k">ON</span> <span class="k">c</span><span class="p">.</span><span class="n">customer_id</span> <span class="o">=</span> <span class="n">o1</span><span class="p">.</span><span class="n">customer_id</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">orders</span> <span class="k">AS</span> <span class="n">o2</span> <span class="k">ON</span> <span class="k">c</span><span class="p">.</span><span class="n">customer_id</span> <span class="o">=</span> <span class="n">o2</span><span class="p">.</span><span class="n">customer_id</span>
    <span class="k">AND</span> <span class="n">o1</span><span class="p">.</span><span class="n">order_number</span> <span class="o">&lt;</span> <span class="n">o2</span><span class="p">.</span><span class="n">order_number</span>
<span class="k">WHERE</span> <span class="n">o2</span><span class="p">.</span><span class="n">order_number</span> <span class="k">IS</span> <span class="k">NULL</span>   
<span class="p">;</span> <span class="c1">-- No errors; 2 rows affected</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ê³ ê°ë²ˆí˜¸  ê³ ê°ëª…  ì£¼ë¬¸ë²ˆí˜¸  ì£¼ë¬¸ê¸ˆì•¡  ì£¼ë¬¸ì¼ì‹œ
1       ì´ë•ìŠ¹  3       200    2018-11-20 14:00:00
3       ì‹ ì´ˆì•„  5       100    2018-10-01 10:00:00
2       ì„í¬ì¼  NULL    NULL   NULL
</code></pre></div></div>

<h2 id="7-ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ-ì–´ë–»ê²Œ-ì‚¬ìš©í•´ìš”">7. ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì–´ë–»ê²Œ ì‚¬ìš©í•´ìš”?</h2>

<p>ëŒ€ëµ ì´ëŸ° ëª¨ìŠµì¼ê²ë‹ˆë‹¤(ê²€ì¦ ì•ˆëœ Pseudo Code ì…ë‹ˆë‹¤).</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Service Layer</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">queryCustomersWithRecentOrderSummary</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$builder</span> <span class="o">=</span> <span class="nx">Customer</span><span class="o">::</span><span class="na">query</span><span class="p">();</span>
    <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">'orders AS o1'</span><span class="p">,</span> <span class="s1">'customers.customer_id'</span><span class="p">,</span> <span class="s1">'='</span><span class="p">,</span> <span class="s1">'o1.customer_id'</span><span class="p">);</span>
    <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">'orders AS o2'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$join</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$join</span><span class="o">-&gt;</span><span class="na">on</span><span class="p">(</span><span class="s1">'customers.customer_id'</span><span class="p">,</span> <span class="s1">'='</span><span class="p">,</span> <span class="s1">'o2.customer_id'</span><span class="p">);</span>
        <span class="nv">$join</span><span class="o">-&gt;</span><span class="na">on</span><span class="p">(</span><span class="s1">'o1.order_number'</span><span class="p">,</span> <span class="s1">'&lt;'</span><span class="p">,</span> <span class="s1">'o2.order_number'</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">whereNull</span><span class="p">(</span><span class="s1">'o2.order_number'</span><span class="p">);</span>
    <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">'customers.*'</span><span class="p">,</span> <span class="s1">'o1.*'</span><span class="p">]);</span>
    <span class="k">return</span> <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ì´ìƒ ì¿¼ë¦¬ëŠ” MySQLì—ì„œë§Œ ê²€ì¦í–ˆìŠµë‹ˆë‹¤. ì œê°€ DB ì „ë¬¸ê°€ê°€ ì•„ë‹ˆë¯€ë¡œ, ë³¸ë¬¸ì— ì‚¬ìš©í•œ ìš©ì–´ë“¤ì´ ì •í™•í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
:ET