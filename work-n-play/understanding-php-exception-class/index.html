<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>

  <meta name="description" content="국어 사전에서는 ‘일반적인 규칙이나 정례에서 벗어나는 일’을 예외라고 정의하고 있다.컴퓨터에서 예외란 ‘프로그램을 실행하는 중에 발생하는 비정상적인 상황’으로 프로그램의 일반적인 실행 흐름을 바꾼다. 예를 들어 함수에 허용하지 않는 인자가 전달되었다거나, 디스크에서 무언가를 읽거나..."/>
  <meta name="google-site-verification" content="ToXKBimREnz49pDNot4b-N9ZJgYcKXPPsHsjhg4Zzuc" />
  <meta name="naver-site-verification" content="7cebcc8e5493169f5401870d9ce57f48d18491cd"/>

  <meta name="msapplication-tap-highlight" content="no"/>

  <!-- Facebook Meta -->
  <meta property="og:title" content="PHP의 예외 클래스 이해하기"/>
  <meta property="og:type" content="Website"/>
  <meta property="og:author" content="appkr (juwonkim@me.com)"/>
  <meta property="og:image" content=""/>

  <!-- Google+ Meta -->
  <meta itemprop="name" content="PHP의 예외 클래스 이해하기">
  <meta itemprop="description" content="국어 사전에서는 ‘일반적인 규칙이나 정례에서 벗어나는 일’을 예외라고 정의하고 있다.컴퓨터에서 예외란 ‘프로그램을 실행하는 중에 발생하는 비정상적인 상황’으로 프로그램의 일반적인 실행 흐름을 바꾼다. 예를 들어 함수에 허용하지 않는 인자가 전달되었다거나, 디스크에서 무언가를 읽거나...">
  <meta itemprop="image" content="">
  <meta itemprop="author" content="appkr (juwonkim@me.com)"/>

  <!-- Twitter Meta -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@appkrs" />
  <meta name="twitter:title" content="PHP의 예외 클래스 이해하기" />
  <meta name="twitter:description" content="국어 사전에서는 ‘일반적인 규칙이나 정례에서 벗어나는 일’을 예외라고 정의하고 있다.컴퓨터에서 예외란 ‘프로그램을 실행하는 중에 발생하는 비정상적인 상황’으로 프로그램의 일반적인 실행 흐름을 바꾼다. 예를 들어 함수에 허용하지 않는 인자가 전달되었다거나, 디스크에서 무언가를 읽거나..." />
  <meta name="twitter:image" content="" />
  <meta name="twitter:domain" content="blog.appkr.kr">

  <!-- Mobile and Rss -->
  <link rel="canonical" href="http://blog.appkr.kr/work-n-play/understanding-php-exception-class/"/>
  <link rel="alternate" type="application/rss+xml" title="Appkr.memo(new Life)" href="http://blog.appkr.kr/feed.xml"/>

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700"/>
  <link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/nanumgothic.css"/>
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons"/>
  <link rel="stylesheet" href="/styles/main.min.css"/>

  <title>PHP의 예외 클래스 이해하기 | Appkr.memo(new Life)</title>

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

<body id="app">

  <nav class="navbar navbar-static-top" role="navigation">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
        <span class="sr-only">Navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">
        Appkr.memo(new Life)
      </a>
    </div>

    <div class="navbar-collapse collapse navbar-responsive-collapse">
      <ul class="nav navbar-nav navbar-right text-center">
        <li class="active"><a href="/">Blog</a></li>
        <!--<li><a href="/guest-book/">Guest Book</a></li>-->
        <li><a href="/profile/">Profile</a></li>
      </ul>
    </div>
  </div>
</nav>


  <div class="container">
  <section id="main" class="col-md-9 minimal">
    <article class="box">
      <div class="box-header">
        <h2>
          <span class="title">PHP의 예외 클래스 이해하기</span>
          <span class="action dropdown pull-right">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" data-target="#">
              <i class="material-icons">share</i>
            </a>

            <ul class="dropdown-menu">
              <li>
                <a href="https://www.facebook.com/sharer/sharer.php?u=http://blog.appkr.kr/work-n-play/understanding-php-exception-class/&title=PHP의 예외 클래스 이해하기" id="sns-facebook">
                  Facebook
                </a>
              </li>
              <li>
                <a href="http://twitter.com/share?url=http://blog.appkr.kr/work-n-play/understanding-php-exception-class/&title=PHP의 예외 클래스 이해하기&text=PHP의 예외 클래스 이해하기" id="sns-twitter">
                  Twitter
                </a>
              </li>
              <li>
                <a href="https://plus.google.com/share?url=http://blog.appkr.kr/work-n-play/understanding-php-exception-class/" id="sns-google">
                  Google+
                </a>
              </li>
            </ul>
          </span>
        </h2>

        <p class="box-meta">
          <span>
            <i class="material-icons">today</i>
            2017-01-07
          </span>
          <span>
            <i class="material-icons">face</i>
            Posted by appkr
          </span>
          <span>
            <i class="material-icons">turned_in</i>
            
              <a href="/categories#work-n-play">
                
                    Work & Play
                  
              </a>
              
            
          </span>
          <span>
            <i class="material-icons">forum</i>
            <a href="/work-n-play/understanding-php-exception-class/#disqus_thread" title="comments">0</a>
          </span>
        </p>
      </div>

      <div class="box-body">
        <p>국어 사전에서는 <strong>‘일반적인 규칙이나 정례에서 벗어나는 일’</strong>을 예외라고 정의하고 있다.</p>

<p>컴퓨터에서 예외란 <strong>‘프로그램을 실행하는 중에 발생하는 비정상적인 상황’</strong>으로 프로그램의 일반적인 실행 흐름을 바꾼다. 예를 들어 함수에 허용하지 않는 인자가 전달되었다거나, 디스크에서 무언가를 읽거나 써야 하는데 디스크에 접근할 수 없다거나, 메모리 공간이 부족해서 변수 값을 저장할 수 없는 경우 등을 들 수 있다.</p>

<p>개발자는 프로그래밍을 할 때 발생할 수 있는 예외 상황을 미리 식별하고, 앞서 말한 상황이 발생하면 예외를 던지고(Throw 또는 Raise), 잡은 예외를 개발자 자신만의 방식으로 핸들링할 수 있다(Catch 또는 Rescue). 개발자가 예상치 못한 예외라면 런타임(PHP의 경우라면 PHP 엔진)이 프로그램의 실행을 멈추고 오류 메시지를 출력하는 등의 일을 할 것이다.</p>

<p><a href="http://rypress.com/tutorials/objective-c/media/exceptions/exceptions-vs-errors.png"><img src="http://rypress.com/tutorials/objective-c/media/exceptions/exceptions-vs-errors.png" alt="" /></a></p>

<p>위 그림은 Objective-C 쪽 얘긴데, 사실 PHP에서 완전 반대다. 어쨌든 PHP 7부터는 <code class="highlighter-rouge">try {...} catch {...}</code> 구문에서 예외(Exception) 뿐만 아니라, 오류(Error)도 캐치할 수 있도록 지원하고 있다.</p>

<p>이 포스트에서는 PHP의 예외 클래스(Exception Class)를 사용하는 기본적인 방법을 설명한다.</p>

<!--more-->
<div class="spacer">• • •</div>

<p>다음 PHP 예제 코드는 예외 클래스의 기본적인 사용법을 담고 있다.</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span> <span class="c1">// exceptions.php
</span>
<span class="sd">/**
 * 개발자가 직접 소비하지 않은 예외를 처리하기 위한 전역 예외 처리기.
 */</span>
<span class="k">function</span> <span class="nf">exception_handler</span><span class="p">(</span><span class="nv">$e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span>
        <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span>
        <span class="nb">get_class</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getPrevious</span><span class="p">())</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="sd">/**
 * 전역 예외 처리기를 설정한다.
 * 여기까지가 일종의 프레임워크 부트스트랩 부분이다.
 */</span>
<span class="nb">set_exception_handler</span><span class="p">(</span><span class="s1">'exception_handler'</span><span class="p">);</span>

<span class="sd">/**
 * 실행할 때 예외를 식별하고 예외를 던지도록 구현해 놓은 함수. 
 * 외부에서 가져온 라이브러리나 직접 구현한 서비스라고 가정 하자. 
 */</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$arg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_int</span><span class="p">(</span><span class="nv">$arg</span><span class="p">)</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">(</span><span class="s1">'입력한 인자가 정수가 아닙니다.'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="s2">"함수가 받은 인자는 </span><span class="si">{</span><span class="nv">$arg</span><span class="si">}</span><span class="s2">입니다."</span><span class="p">;</span>
<span class="p">}</span>

<span class="sd">/**
 * 여기서 부터 클라이언트 코드(우리가 짠 애플리케이션)라고 가정하자.
 */</span> 
<span class="k">try</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="nx">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span>
        <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span> 
        <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getCode</span><span class="p">(),</span> 
        <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getFile</span><span class="p">(),</span> 
        <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getLine</span><span class="p">(),</span> 
        <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getTrace</span><span class="p">(),</span> 
        <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getPrevious</span><span class="p">(),</span> 
        <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getTraceAsString</span><span class="p">()</span>
    <span class="p">);</span>

    <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span>
        <span class="s1">'예외 체인을 따라 버블 업 합니다.'</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span>
        <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getCode</span><span class="p">(),</span>
        <span class="nv">$e</span>
    <span class="p">);</span>
<span class="p">}</span> <span class="nx">finally</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="s1">'Finally 안쪽의 문장은 무조건 실행됩니다.'</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">var_dump</span><span class="p">(</span><span class="s1">'마지막 문장입니다.'</span><span class="p">);</span>
</code></pre>
</div>

<p>PHP에서 예외를 던질 때는 <code class="highlighter-rouge">throw</code> 키워드를 사용하고, 그 다음에 던질 예외 클래스의 객체를 제공하면 된다.</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">throw</span> <span class="k">new</span> <span class="nx">FooException</span><span class="p">(</span><span class="s1">'메시지'</span><span class="p">);</span>
</code></pre>
</div>

<p>예외 클래스의 프로토타입(생성자의 인자)은 다음과 같다. 대괄호는 배열 문법이 아니고, 선택사항(optional)이란 뜻이다. 즉 생성자에 아무런 인자를 안 넣어도 된다.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>Exception::__construct <span class="o">([</span> string <span class="nv">$message</span> <span class="o">=</span> <span class="s2">""</span> <span class="o">[</span>, int <span class="nv">$code</span> <span class="o">=</span> 0 <span class="o">[</span>, Throwable <span class="nv">$previous</span> <span class="o">=</span> NULL <span class="o">]]]</span> <span class="o">)</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">Exception</code>은 PHP의 SPL(Standard PHP Library, PHP 바이너리에 내장)이 제공하는 최상위 예외 클래스다. 우리 예제 코드에서 사용한 <code class="highlighter-rouge">InvalidArgumentException</code>과 <code class="highlighter-rouge">Exception</code>과의 상속 관계는 다음과 같다. 살짝 스포일링하자면, SPL 또는 프레임워크가 제공하는 예외 클래스를 상속하여 우리만의 커스컴 예외 클래스를 만들 수 있다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>InvalidArgumentException -&gt; LogicException -&gt; Exception
</code></pre>
</div>

<h2 id="section">1. 정상 실행</h2>

<p>이 코드의 실행 결과는 다음과 같다.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>~/working-with-exceptions <span class="nv">$ </span>php exceptions.php
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>~/working-with-exceptions/exceptions.php:33:
string<span class="o">(</span>38<span class="o">)</span> <span class="s2">"함수가 받은 인자는 1입니다."</span>

~/working-with-exceptions/exceptions.php:51:
string<span class="o">(</span>54<span class="o">)</span> <span class="s2">"Finally 안쪽의 문장은 무조건 실행됩니다."</span>

~/working-with-exceptions/exceptions.php:54:
string<span class="o">(</span>26<span class="o">)</span> <span class="s2">"마지막 문장입니다."</span>
</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">foo()</code> 함수를 <code class="highlighter-rouge">try {}</code> 블록 안에서 호출하고 있다.</li>
  <li><code class="highlighter-rouge">foo()</code> 함수는 정수 <code class="highlighter-rouge">1</code>을 인자로 받았으므로, <code class="highlighter-rouge">if (is_int($arg) === false) {...}</code> 부분을 통과하고 정상적으로 값을 반환한다.</li>
  <li><code class="highlighter-rouge">finally {}</code> 블록 안의 내용은 예외가 발생하든 하지 않든 무조건 실행된다.</li>
  <li><code class="highlighter-rouge">try {} catch {}</code> 블록에서 <code class="highlighter-rouge">throw</code> 또는 <code class="highlighter-rouge">return</code> 구문을 만나지 않았으므로 마지막 문장은 실행된다.</li>
</ul>

<h2 id="section-1">2. 예외 상황</h2>

<p>예외 상황을 만들어 보자.</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span> <span class="c1">// exceptions.php
</span>
<span class="c1">// ...
</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="nx">foo</span><span class="p">(</span><span class="s1">'string'</span><span class="p">));</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...
</span><span class="p">}</span>

<span class="c1">// ...
</span></code></pre>
</div>

<p>수정한 코드의 실행 결과는 다음과 같다.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>~/working-with-exceptions <span class="nv">$ </span>php exceptions.php
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>~/working-with-exceptions/exceptions.php:42:
string<span class="o">(</span>43<span class="o">)</span> <span class="s2">"입력한 인자가 정수가 아닙니다."</span>

~/working-with-exceptions/exceptions.php:42:
int<span class="o">(</span>0<span class="o">)</span>

~/working-with-exceptions/exceptions.php:42:
string<span class="o">(</span>37<span class="o">)</span> <span class="s2">"~/working-with-exceptions/exceptions.php"</span>

~/working-with-exceptions/exceptions.php:42:
int<span class="o">(</span>25<span class="o">)</span>

~/working-with-exceptions/exceptions.php:42:
array<span class="o">(</span>1<span class="o">)</span> <span class="o">{</span>
  <span class="o">[</span>0] <span class="o">=</span>&gt;
  array<span class="o">(</span>4<span class="o">)</span> <span class="o">{</span>
    <span class="s1">'file'</span> <span class="o">=</span>&gt;
    string<span class="o">(</span>37<span class="o">)</span> <span class="s2">"~/working-with-exceptions/exceptions.php"</span>
    <span class="s1">'line'</span> <span class="o">=</span>&gt;
    int<span class="o">(</span>33<span class="o">)</span>
    <span class="s1">'function'</span> <span class="o">=</span>&gt;
    string<span class="o">(</span>3<span class="o">)</span> <span class="s2">"foo"</span>
    <span class="s1">'args'</span> <span class="o">=</span>&gt;
    array<span class="o">(</span>1<span class="o">)</span> <span class="o">{</span>
      <span class="o">[</span>0] <span class="o">=</span>&gt;
      string<span class="o">(</span>6<span class="o">)</span> <span class="s2">"string"</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

~/working-with-exceptions/exceptions.php:42:
NULL

~/working-with-exceptions/exceptions.php:42:
string<span class="o">(</span>69<span class="o">)</span> <span class="s2">"#0 ~/working-with-exceptions/exceptions.php(33): foo('string')
#1 {main}"</span>

~/working-with-exceptions/exceptions.php:51:
string<span class="o">(</span>54<span class="o">)</span> <span class="s2">"Finally 안쪽의 문장은 무조건 실행됩니다."</span>

~/working-with-exceptions/exceptions.php:10:
string<span class="o">(</span>88<span class="o">)</span> <span class="s2">"예외 체인을 따라 버블 업 합니다.입력한 인자가 정수가 아닙니다."</span>

~/working-with-exceptions/exceptions.php:10:
string<span class="o">(</span>24<span class="o">)</span> <span class="s2">"InvalidArgumentException"</span>
</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">foo()</code> 함수는 문자열 <code class="highlighter-rouge">'string'</code>을 인자로 받았으므로, <code class="highlighter-rouge">if (is_int($arg) === false) {...}</code> 부분에 걸려 <code class="highlighter-rouge">InvalidArgumentException</code>을 던진다. 프로그램의 실행 제어 측면에서 <code class="highlighter-rouge">throw</code> 키워드는 해당 블록에서 <code class="highlighter-rouge">throw</code> 다음 문장을 실행하지 않는다는 점에서 <code class="highlighter-rouge">return</code>과 같다.</li>
  <li><code class="highlighter-rouge">foo()</code> 함수에서 던진 예외는 <code class="highlighter-rouge">catch (Throwable $e) {...}</code>에서 잡는다. 예외를 잡을 때는 잡을 예외 별로 <code class="highlighter-rouge">catch</code> 블록을 쓸 수 있다. 우리 예제에서는 <code class="highlighter-rouge">Throwable</code>이란 녀석을 전부 잡겠다고 선언하고 있는데, 이는 PHP 7이상의 기능으로 모든 예외와 모든 오류를 전부 잡겠다는 의미다.</li>
  <li>우리의 <code class="highlighter-rouge">catch</code> 블록에서는 잡은 예외 객체가 제공하는 다양한 메서드를 보여주고 있다. 즉, 이 예외 메서드들을 이용하여 로깅을 하거나 슬랙을 보내는 등의 예외 처리를 할 수 있다. 해당 내용은 다음 포스트를 참고 하시기 바란다.
    <ul>
      <li><a href="http://blog.appkr.kr/work-n-play/php-application-logging-to-elasticsearch-using-monolog/">Monolog를 이용한 애플리케이션 로깅</a></li>
      <li><a href="http://blog.appkr.kr/work-n-play/super-fast-debug-deploy/">엄청나게 빠른 버그 감지, 디버그, 코드 배포</a></li>
    </ul>
  </li>
  <li>예외 처리를 끝내고 다시 예외를 던질 수도 있는데, 이때는 <code class="highlighter-rouge">try {...} catch {...}</code> 블록 밖으로 예외를 던지는 것이고, 이 녀석을 다시 잡는 부분이 없으므로, 코드 시작 부분에 등록한 전역 예외 처리기(<code class="highlighter-rouge">exception_handler()</code>) 함수가 작동한다. 전역 예외 처리기에서 <code class="highlighter-rouge">getPrevious()</code> 메서드를 이용해서 예외 발생의 선후 관계를 확인할 수 있다는 점을 유심히 봐두기 바란다. 실무에서 디버깅할 때 엄청난 도움이 될 수 있다.</li>
  <li><code class="highlighter-rouge">finally {}</code> 블록 안의 내용은 예외가 발생하든 하지 않든 무조건 실행된다.</li>
  <li><code class="highlighter-rouge">catch</code> 블록에서 예외를 다시 던졌으므로, 그 이하의 내용, 즉 마지막 문장은 실행되지 않는다.</li>
</ul>

<h2 id="section-2">3. 예외 처리 로직 분기</h2>

<p>우리 예제에서는 <code class="highlighter-rouge">foo()</code> 함수를 실행할 때 <code class="highlighter-rouge">InvalidArgumentException</code>만 발생하지만, 실제로는 <code class="highlighter-rouge">try</code> 블록 안쪽의 코드를 실행하는 동안 다양한 예외가 발생할 수 있다. 이 때 <code class="highlighter-rouge">catch</code> 블록에 딱 정확한 예외 이름을 타입 힌트로 제공해서 예외 처리 로직을 분기할 수 있다. 예제 코드를 다음과 같이 수정했다.</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span> <span class="c1">// exceptions.php
</span>
<span class="c1">// ...
</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="nx">foo</span><span class="p">(</span><span class="s1">'string'</span><span class="p">));</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">InvalidArgumentException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="s1">'첫번째 catch 블록'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">UnexpectedValueException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="s1">'두번째 catch 블록'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="s1">'세번째 catch 블록'</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ...
</span></code></pre>
</div>

<p>실행하면 다음 결과를 볼 수 있다.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>~/working-with-exceptions <span class="nv">$ </span>php exceptions.php
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>~/working-with-exceptions/exceptions.php:36:
string<span class="o">(</span>22<span class="o">)</span> <span class="s2">"첫번째 catch 블록"</span>

~/working-with-exceptions/exceptions.php:64:
string<span class="o">(</span>26<span class="o">)</span> <span class="s2">"마지막 문장입니다."</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">catch</code>에서 잡는 예외의 순서는 중요하다. 예제를 보자.</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span> <span class="c1">// exceptions.php
</span>
<span class="c1">// ...
</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="nx">foo</span><span class="p">(</span><span class="s1">'string'</span><span class="p">));</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="s1">'엉뚱한 예외 처리 로직'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">InvalidArgumentException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="s1">'우리가 기대하던 내용'</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ...
</span></code></pre>
</div>

<p>실행 결과는 이렇다. 항상 구체적인 예외, 즉 자식 예외에서 부모 예외 순으로 잡아야 한다.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>~/working-with-exceptions <span class="nv">$ </span>php exceptions.php
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>~/working-with-exceptions/exceptions.php:36:
string<span class="o">(</span>30<span class="o">)</span> <span class="s2">"엉뚱한 예외 처리 로직"</span>

~/working-with-exceptions/exceptions.php:65:
string<span class="o">(</span>26<span class="o">)</span> <span class="s2">"마지막 문장입니다."</span>
</code></pre>
</div>

<h2 id="section-3">4. 결론</h2>

<p>예외를 처리하지 않는 경우를 상상해 보자. <code class="highlighter-rouge">foo()</code> 함수에 타입 힌트를 써서 예외 상황을 만들었다.</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$arg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s2">"함수가 받은 인자는 </span><span class="si">{</span><span class="nv">$arg</span><span class="si">}</span><span class="s2">입니다."</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">var_dump</span><span class="p">(</span><span class="nx">foo</span><span class="p">(</span><span class="s1">'string'</span><span class="p">));</span>
</code></pre>
</div>

<p>이 코드의 실행 결과는 다음과 같다. 전역 예외 처리기 또는 에러 처리가가 없으므로, PHP 런타임이 치명적 오류(Fatal error)를 내 뱉고 있는 상황이다. 운영 중인 웹 사이트에서 이런 메시지가 나온 적이 있는가? 그런데, 이 상황을 몇 시간째 모르고 있었던 경우는 없는가? 아찔하다~</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>PHP Fatal error:  Uncaught TypeError: Argument 1 passed to foo<span class="o">()</span> must be of the <span class="nb">type </span>integer, string given, called <span class="k">in</span> /Users/appkr/workspace/exceptions.php on line 31 and defined <span class="k">in</span> /Users/appkr/workspace/exceptions.php:22
Stack trace:
<span class="c">#0 /Users/appkr/workspace/exceptions.php(31): foo('string')</span>
<span class="c">#1 {main}</span>
  thrown <span class="k">in</span> /Users/appkr/workspace/exceptions.php on line 22

Call Stack:
    0.0002     355912   1. <span class="o">{</span>main<span class="o">}()</span> /Users/appkr/workspace/exceptions.php:0
    0.0002     355912   2. foo<span class="o">()</span> /Users/appkr/workspace/exceptions.php:31
</code></pre>
</div>

<p>다음 편에서는 라라벨 프레임워크를 이용해서 커스텀 예외 클래스를 만들고 프로그램 실행 흐름을 안전하게 제어하는 방법을 살펴 보기로 하자.</p>

      </div>

      <footer class="box-tags">
        <span><i class="material-icons">label</i> Tags:</span>
        
          <a href="/tags#개발자">
            개발자
          </a>
          , 
        
          <a href="/tags#PHP">
            PHP
          </a>
          
        
      </footer>
    </article>

    <nav id="pagination">
      <ul class="pager">
        
        <li class="previous">
          <a href="/work-n-play/firebase-cloud-message-php-server-implementation-part-2/">
            <span aria-hidden="true">
              <i class="material-icons">navigate_before</i>
            </span>
            <span class="pager-title-sm">Older</span>
            <span class="pager-title">
              모바일 푸쉬 메시지(FCM)를 ...
            </span>
          </a>
        </li>
        

        
        <li class="next disabled">
          <a href="#">
            <span>Newer</span>
            <span aria-hidden="true">
              <i class="material-icons">navigate_next</i>
            </span>
          </a>
        </li>
        
      </ul>
    </nav>

    <div class="comments" style="margin-bottom: 30px;">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//appkr.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

  </section>

  <aside id="sidebar" class="col-md-3">
    <section class="box" id="search">
  <div class="box-body">
    <form action="#">
      <div class="form-group">
        <input class="form-control input-lg" type="text" id="q" placeholder="Search...">
        <ul id="q-results"></ul>
      </div>
    </form>
  </div>
</section>

<section class="box" id="categories">
  <div class="box-header">
    <h3>Categories</h3>
  </div>

  <div class="box-body">
    <ul>
      <li>
        <a href="/categories#around-me">
          Around Me
          <span class="badge">25</span>
        </a>
      </li>
      <li>
        <a href="/categories#learn-n-think">
          Learn & Think
          <span class="badge">70</span>
        </a>
      </li>
      <li>
        <a href="/categories#work-n-play">
          Work & Play
          <span class="badge">50</span>
        </a>
      </li>
      <li>
        <a href="/categories#imported">
          Imported
          <span class="badge">3</span>
        </a>
      </li>
      <li>
        <a href="/categories#uncategorized">
          Uncategorized
          <span class="badge">2</span>
        </a>
      </li>
    </ul>
  </div>
</section>

<section class="box" id="tags">
  <div class="box-header">
    <h3>Tags</h3>
  </div>

  <div class="box-body tags">
    <div class="tags">
    
    
    <span style="font-size: 98%">
      <a href="/tags#3d">
        3d
      </a>
    </span>
    
    <span style="font-size: 102%">
      <a href="/tags#API">
        API
      </a>
    </span>
    
    <span style="font-size: 98%">
      <a href="/tags#Apache Thrift">
        Apache Thrift
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#CSS">
        CSS
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#Docker">
        Docker
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#Dotfiles">
        Dotfiles
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#Facebook">
        Facebook
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#Generator">
        Generator
      </a>
    </span>
    
    <span style="font-size: 102%">
      <a href="/tags#Git">
        Git
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#JWT">
        JWT
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#Javascript">
        Javascript
      </a>
    </span>
    
    <span style="font-size: 110%">
      <a href="/tags#Jekyll">
        Jekyll
      </a>
    </span>
    
    <span style="font-size: 122%">
      <a href="/tags#Laravel">
        Laravel
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#Lumen">
        Lumen
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#OS X">
        OS X
      </a>
    </span>
    
    <span style="font-size: 126%">
      <a href="/tags#PHP">
        PHP
      </a>
    </span>
    
    <span style="font-size: 98%">
      <a href="/tags#RESTful">
        RESTful
      </a>
    </span>
    
    <span style="font-size: 98%">
      <a href="/tags#RPC">
        RPC
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#Ruby">
        Ruby
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#Streaming">
        Streaming
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#URL Rewriting">
        URL Rewriting
      </a>
    </span>
    
    <span style="font-size: 98%">
      <a href="/tags#Web">
        Web
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#Websocket">
        Websocket
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#adobe">
        adobe
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#amazon">
        amazon
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#amd">
        amd
      </a>
    </span>
    
    <span style="font-size: 142%">
      <a href="/tags#android">
        android
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#apple">
        apple
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#ar">
        ar
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#architecture">
        architecture
      </a>
    </span>
    
    <span style="font-size: 110%">
      <a href="/tags#arm">
        arm
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#bada">
        bada
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#bluetooth">
        bluetooth
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#bus">
        bus
      </a>
    </span>
    
    <span style="font-size: 102%">
      <a href="/tags#cdp">
        cdp
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#chrome">
        chrome
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#cloud">
        cloud
      </a>
    </span>
    
    <span style="font-size: 114%">
      <a href="/tags#codec">
        codec
      </a>
    </span>
    
    <span style="font-size: 98%">
      <a href="/tags#connectivity">
        connectivity
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#cpu">
        cpu
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#ebook">
        ebook
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#emulator">
        emulator
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#flash">
        flash
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#framework">
        framework
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#gms">
        gms
      </a>
    </span>
    
    <span style="font-size: 110%">
      <a href="/tags#google">
        google
      </a>
    </span>
    
    <span style="font-size: 110%">
      <a href="/tags#gtd">
        gtd
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#intel">
        intel
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#ios">
        ios
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#iphone">
        iphone
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#java">
        java
      </a>
    </span>
    
    <span style="font-size: 106%">
      <a href="/tags#lbs">
        lbs
      </a>
    </span>
    
    <span style="font-size: 98%">
      <a href="/tags#limo">
        limo
      </a>
    </span>
    
    <span style="font-size: 106%">
      <a href="/tags#linux">
        linux
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#mcu">
        mcu
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#memory">
        memory
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#microsoft">
        microsoft
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#mobile">
        mobile
      </a>
    </span>
    
    <span style="font-size: 98%">
      <a href="/tags#opencore">
        opencore
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#opengl">
        opengl
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#opengles">
        opengles
      </a>
    </span>
    
    <span style="font-size: 102%">
      <a href="/tags#opensource">
        opensource
      </a>
    </span>
    
    <span style="font-size: 98%">
      <a href="/tags#openvg">
        openvg
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#platform">
        platform
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#pnd">
        pnd
      </a>
    </span>
    
    <span style="font-size: 106%">
      <a href="/tags#presentation">
        presentation
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#pvcore">
        pvcore
      </a>
    </span>
    
    <span style="font-size: 98%">
      <a href="/tags#se">
        se
      </a>
    </span>
    
    <span style="font-size: 98%">
      <a href="/tags#sns">
        sns
      </a>
    </span>
    
    <span style="font-size: 114%">
      <a href="/tags#soc">
        soc
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#symbian">
        symbian
      </a>
    </span>
    
    <span style="font-size: 98%">
      <a href="/tags#tech">
        tech
      </a>
    </span>
    
    <span style="font-size: 98%">
      <a href="/tags#ted">
        ted
      </a>
    </span>
    
    <span style="font-size: 98%">
      <a href="/tags#tedx">
        tedx
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#windowsmobile">
        windowsmobile
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#wss">
        wss
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#x86">
        x86
      </a>
    </span>
    
    <span style="font-size: 110%">
      <a href="/tags#史記">
        史記
      </a>
    </span>
    
    <span style="font-size: 98%">
      <a href="/tags#孟子">
        孟子
      </a>
    </span>
    
    <span style="font-size: 102%">
      <a href="/tags#孫子兵法">
        孫子兵法
      </a>
    </span>
    
    <span style="font-size: 230%">
      <a href="/tags#개발자">
        개발자
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#경력개발">
        경력개발
      </a>
    </span>
    
    <span style="font-size: 138%">
      <a href="/tags#기업철학">
        기업철학
      </a>
    </span>
    
    <span style="font-size: 174%">
      <a href="/tags#기획자">
        기획자
      </a>
    </span>
    
    <span style="font-size: 146%">
      <a href="/tags#리더쉽">
        리더쉽
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#생산성">
        생산성
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#소프트웨어공학">
        소프트웨어공학
      </a>
    </span>
    
    <span style="font-size: 210%">
      <a href="/tags#인생철학">
        인생철학
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#자녀교육">
        자녀교육
      </a>
    </span>
    
    <span style="font-size: 102%">
      <a href="/tags#전략">
        전략
      </a>
    </span>
    
    <span style="font-size: 146%">
      <a href="/tags#조직관리">
        조직관리
      </a>
    </span>
    
    <span style="font-size: 98%">
      <a href="/tags#조직문화">
        조직문화
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#조직행동">
        조직행동
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#철학">
        철학
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#취미">
        취미
      </a>
    </span>
    
    <span style="font-size: 94%">
      <a href="/tags#특기">
        특기
      </a>
    </span>
    
    <span style="font-size: 98%">
      <a href="/tags#프로젝트관리">
        프로젝트관리
      </a>
    </span>
    
    </div>
  </div>
</section>

<section class="box" id="recent-posts">
  <div class="box-header">
    <h3>Recent Posts</h3>
  </div>

  <div class="box-body">
    <ul>
      
      <li>
        <h4>
          <small class="box-meta"><i class="material-icons">today</i> 2017-01-07</small>
          <a href="/work-n-play/understanding-php-exception-class/">PHP의 예외 클래스 이해하기</a>
        </h4>
      </li>
      
      <li>
        <h4>
          <small class="box-meta"><i class="material-icons">today</i> 2016-12-24</small>
          <a href="/work-n-play/firebase-cloud-message-php-server-implementation-part-2/">모바일 푸쉬 메시지(FCM)를 위한 PHP 서버 구현 2부</a>
        </h4>
      </li>
      
      <li>
        <h4>
          <small class="box-meta"><i class="material-icons">today</i> 2016-12-18</small>
          <a href="/work-n-play/firebase-cloud-message-php-server-implementation-part-1/">모바일 푸쉬 메시지(FCM)를 위한 PHP 서버 구현 1부</a>
        </h4>
      </li>
      
    </ul>
  </div>
</section>

<section class="box" id="recent-comments">
  <div class="box-header">
    <h3>Recent Comments</h3>
  </div>

  <div class="box-body dsq-widget">
    <script type="text/javascript" src="http://appkr.disqus.com/recent_comments_widget.js?num_items=5&hide_mods=0&hide_avatars=0&avatar_size=32&excerpt_length=100"></script>
  </div>
</section>

<section class="box" id="recent-feeds">
  <div class="box-header">
    <h3>Facebook Posts</h3>
  </div>

  <div class="box-body">
    <ul id="facebook-feed">
      <script id="facebook-feed-template" type="text/x-template">
        <li>
          <span class="facebook-message">
            { message }
          </span>
          ·
          <span class="facebook-meta">
            <a href="https://www.facebook.com/juwonkimatmedotcom/posts/{ id }">
              { created_time }
            </a>
          </span>
        </li>
      </script>
    </ul>
  </div>
</section>

  </aside>
</div>


  <footer id="site-footer">
  <h4>
    <a href="/">
      Appkr.memo(new Life)
    </a>
  </h4>
  <p>
    &copy; 2008~2017 •
    Built with <a href="http://jekyllrb.com/">Jekyll</a> •
    Hosted by <a href="https://pages.github.com/">Github</a> •
    <a href="/feed.xml">Rss</a>
  </p>
</footer>


  <div id="back-to-top">
    <a href="#" title="Scroll to Top">
      <i class="material-icons">keyboard_arrow_up</i>
    </a>
  </div>

  <script src="/scripts/main.min.js"></script>
</body>

</html>
